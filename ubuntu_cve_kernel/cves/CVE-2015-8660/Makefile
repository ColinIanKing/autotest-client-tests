# source: http://www.halfdog.net/Security/2015/UserNamespaceOverlayfsSetuidWriteExec/

all:
	gcc -o UserNamespaceOverlayfsSetuidWriteExec UserNamespaceOverlayfsSetuidWriteExec.c

clean:
	rm -f UserNamespaceOverlayfsSetuidWriteExec su

# This program should gain root quickly and return true triggering a failure,
# otherwise on failure it may timeout which also indicates a passing case.
# Run as a normal user.
check: all
	timeout 10 sudo -u ubuntu ./UserNamespaceOverlayfsSetuidWriteExec -- /bin/true && exit 1 || exit 0
