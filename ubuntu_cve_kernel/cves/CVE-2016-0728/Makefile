# dependencies: libkeyutils-dev
# source: http://perception-point.io/2016/01/14/analysis-and-exploitation-of-a-linux-kernel-vulnerability-cve-2016-0728/
# source: https://gist.github.com/PerceptionPointTeam/3864cf0c2a77f7ebd1dd#file-leak-c
# source: http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=23567fd052a9abb6d67fe8e7a9ccdd9800a540f2
# NOTE: this doesn't actually give us root, but just demonstrates that the
# keyring is leaky. In addition if we grep for 'leaked-keyring' immedately
# after leak is invoked, we'll see it. With the sleep we see the refs get
# garbage collected properly.

all: 
	gcc leak.c -o leak -lkeyutils -Wall

clean:
	rm -f leak

check: all
	./leak && sleep 1
	! cat /proc/keys | grep 'leaked-keyring'
